#!/bin/bash

# pai-backup-bot
# Backup Bot and keep 7 days
# pai-script-id=8fc5a3dd-ba8d-4cd4-51ce-7e0ae086b247
# Created by Eran Caballero on Thr Apr 18 12:15:27 UTC 2019
# Generated by PAI Linux Bot
# Copyrights PAI Tech INC 2019, all rights reserved

# PAI includes

PAI_SCRIPT_ID=8fc5a3dd-ba8d-4cd4-51ce-7e0ae086b247

PAI=/var/PAI
PAI_BOT_FOLDER=$PAI/Bot
PAI_BOT_PROJECT_FOLDER=$PAI_BOT_FOLDER/PAI-BOT-JS
PAI_BOT_MODULES_FOLDER=node_modules

. $PAI/System/pai.sh

# PAI functions

pai_8fc5a3dd-ba8d-4cd4-51ce-7e0ae086b247_intro() {
pai_log_sep
pai_log 'starting pai-backup-mysql-db...'
}

pai_update_modules()
{
	pai_log_sep
	pai_log 'Deleting node_modules folder'
	rm -rf $PAI_BOT_MODULES_FOLDER
	pai_log_sep
	pai_log 'Cleaning npm cache..'
	npm cache clean --force
	pai_log_sep
	pai_log 'Install & update modules...'
	npm i
	npm audit fix
	pai_log_sep
        pai_log 'Install ui manually...'
	npm i @pai-tech/tf-bank-ui@latest
	npm update
	pm2 restart 2
}

pai_8fc5a3dd-ba8d-4cd4-51ce-7e0ae086b247_end() {
pai_log 'done :)'
}

# PAI main flow

pai_8fc5a3dd-ba8d-4cd4-51ce-7e0ae086b247_intro
pai_update_modules
pai_8fc5a3dd-ba8d-4cd4-51ce-7e0ae086b247_end
